{% extends 'base.html' %}
{% load static %}
{% load tags %}

{% block title %}
	<title>{{ target_profile.user.username }} - The Impossible</title>
{% endblock %}

{% block nav_custom %}
	<li class="nav-item">
		<a class="nav-link" href="{% url 'idea_explore_page' week_num=date.week page_num=1 %}">Explore</a>
	</li>
	{% if user.is_authenticated %}
		<li class="nav-item dropdown">
	        <a class="nav-link" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Account</a>
	        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
	        	<a class="dropdown-item" href="{% url 'account_notification_page' page_num='1' %}">Notification</a>
				<a class="dropdown-item" href="#">People</a>
				<a class="dropdown-item" href="#">Direct Message</a>
				<div class="dropdown-divider"></div>
				<a class="dropdown-item" href="{% url 'account_setting_profile_page' %}">Settings</a>
	        </div>
		</li>
	{% endif %}
{% endblock %}

{% block content %}
	<!-- Lato Font -->
	<link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">

	<link rel="stylesheet" type="text/css" href="{% static 'idea/pagination/main.css' %}">

	<link rel="stylesheet" type="text/css" href="{% static 'usermgmt/account_dashboard_page/main.css' %}">

	<script type="text/javascript" src="{% static 'usermgmt/account_dashboard_page/resize.js' %}"></script>

	<div class="wrapper user-info">
		<div class="user-info-container">
			<div class="target-profile-img-wrapper">
				<button class="btn" {% if target_profile.user == user %} onclick="window.location.href='{% if target_profile.profile_img %}{% url 'userupload_profile_img_page' profile_pk=target_profile.pk file_pk=target_profile.profile_img.pk %}{% else %}{% url 'userupload_profile_img_page' profile_pk=target_profile.pk file_pk=None %}{% endif %}'" {% endif %}>{% if target_profile.profile_img %}<img class="target-profile-img" src="{{ target_profile.profile_img.file.url }}">{% endif %}</button>
			</div>
			<div style="display: inline-block;">
				<h1 class="username">@{{ username }}</h1>
				<h5 class="fullname">{{ target_profile.user.get_full_name }}</h5>
			</div>
			<p class="bio">{{ target_profile.bio }}</p>
			{% if target_profile.website %}
				<a class="website" href="{{ target_profile.website }}"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="rgb(227,176,75)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg> {{ target_profile.website }}</a>
			{% endif %}
			<p class="joined-timestamp"><img src="{% static 'component/feather_svg/calendar.svg' %}"> Joined {{ target_profile.timestamp.date }}</p>
			<p class="daily-limit"><img src="{% static 'component/feather_svg/edit.svg' %}"> Daily Limit {{ target_profile.daily_limit }}</p>
			<br>
			<p class="followers">{{ followers.count }} Followers</p>
			<p class="following">{{ target_profile.following.count }} Following</p>
			{% if target_profile.user == user %}
				<!-- Edit button -->
				<button class="btn btn-dark btn-black bold edit-profile" onclick="window.location.href='{% url 'account_setting_profile_page' %}'">Edit Profile</button>
			{% else %}
				<!-- Follow button -->
				<button class="btn btn-dark btn-black bold edit-profile" onclick="window.location.href='{% if user.is_authenticated %}{% url 'account_follow_view' username=username %}{% else %}{% url 'login_page' %}{% endif %}'">{% if target_profile.user in profile.following.all %}Unfollow{% else %}Follow{% endif%} @{{ username }}</button>
			{% endif %}
		</div>
		<!-- Target user notification -->
		{% include 'usermgmt/notification.html' with notifications=target_notifications %}
	</div>
	<div class="wrapper">
		<div class="header-wrapper">
			<button class="header btn btn-yellow {% if content_filter == 'my' %}btn-yellow-outline{% endif %}" onclick="window.location.href='{% url 'account_dashboard_page' username=username content_filter='my' page_num=1 %}'">{% if target_profile.user == user %}My{% endif %} Ideas</button>
			<button class="header btn btn-yellow {% if content_filter == 'liked' %}btn-yellow-outline{% endif %}" onclick="window.location.href='{% url 'account_dashboard_page' username=username content_filter='liked' page_num=1 %}'">Liked Ideas</button>
			{% if target_profile.user == user %}
				<button class="header btn btn-yellow {% if content_filter == 'starred' %}btn-yellow-outline{% endif %}" onclick="window.location.href='{% url 'account_dashboard_page' username=username content_filter='starred' page_num=1 %}'">Starred Ideas</button>
			{% endif %}
		</div>
		{% include 'idea/masonary.html' %}

		<!-- Page selector -->
		<div class="page-link-wrapper">
			<!-- Previous page link -->
			<a {% if page_num|add:'-1' > 0 %} href="{% url 'account_dashboard_page' username=username content_filter=content_filter page_num=page_num|add:'-1' %}" {% endif %} class="{% if page_num|add:'-1' > 0 %} change-page {% else %} change-page-unavailable {% endif %}">
				<svg class="left-arrow" width="27" height="41" viewBox="0 0 27 41" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path fill-rule="evenodd" clip-rule="evenodd" d="M26 5.99999L5.99999 26L0.34314 20.3431L20.3431 0.34314L26 5.99999Z"/>
				<path fill-rule="evenodd" clip-rule="evenodd" d="M21 41L0.999991 21L6.65685 15.3431L26.6568 35.3431L21 41Z"/>
				</svg>
			</a>

			<!-- Link omission (...) -->
			{% if page_num|add:'-3' > 0 %}
				<p class="word-omission">..</p>
			{% endif %}

			<!-- All page links -->
			{% for i in max_page|times %}
				<!-- Only show a maximum of 5 page links -->
				{% if i|add:1 < page_num|add:3 and i|add:1 > page_num|add:'-3' %}
					<a class="{% if i|add:1 == page_num %} current-page-link {% else %} page-link {% endif %}" href="{% url 'account_dashboard_page' username=username content_filter=content_filter page_num=i|add:1 %}"><b>{{ i|add:1 }}</b></a>
				{% endif %}
			{% endfor %}

			<!-- Link omission (...) -->
			{% if page_num|add:3 < max_page|add:1 %}
				<p class="word-omission">..</p>
			{% endif %}

			<!-- Next page link -->
			<a {% if page_num|add:1 <= max_page %} href="{% url 'account_dashboard_page' username=username content_filter=content_filter page_num=page_num|add:1 %}" {% endif %} class="{% if page_num|add:1 <= max_page %} change-page {% else %} change-page-unavailable {% endif %}">
				<svg class="right-arrow" width="27" height="41" viewBox="0 0 27 41" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path fill-rule="evenodd" clip-rule="evenodd" d="M1.00001 5.99999L21 26L26.6569 20.3431L6.65686 0.34314L1.00001 5.99999Z"/>
				<path fill-rule="evenodd" clip-rule="evenodd" d="M6.00001 41L26 21L20.3432 15.3431L0.343155 35.3431L6.00001 41Z"/>
				</svg>
			</a>
		</div>
	</div>

	<!-- Followers' profiles -->
	<div class="wrapper">
		<div class="follower-header">
			<h1>Followers</h1>
			<a href="#">View All <img src="{% static 'component/feather_svg/arrow-right-circle.svg' %}"></a>
		</div>
		<div class="horizontal-overflow-wrapper">
			{% if followers_profile %}
				<div class="horizontal-container">
					{% for follower in followers_profile %}
						{% if follower.profile_img.file %}
							<div class="profile-img-wrapper">
								<a href="{% url 'account_dashboard_page' username=follower.user.username content_filter='my' page_num=1 %}"><img class="profile-img" src="{{ follower.profile_img.file.url }}"></a>
							</div>
						{% endif %}
					{% endfor %}
				</div>
			{% else %}
				<p class="no-follower-text">(No user follows @{{ target_profile.user.username }})</p>
			{% endif %}
		</div>
	</div>
{% endblock %}