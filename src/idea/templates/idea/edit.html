{% extends 'base.html' %}
{% load static %}

{% block title %}
	<title>{{ idea.name }} - The Impossible</title>
{% endblock %}

{% block content %}
	<!-- Explore page css -->
	<link rel="stylesheet" type="text/css" href="{% static 'idea/explore_page/main.css' %}">

	<!-- Detail page css -->
	<link rel="stylesheet" type="text/css" href="{% static 'idea/detail_page/main.css' %}">

	<!-- Main css -->
	<link rel="stylesheet" type="text/css" href="{% static 'idea/edit_page/main.css' %}">

	<!-- Mobile js -->
	<script type="text/javascript" src="{% static 'component/base/mobile.js' %}"></script>
	
	<!-- Resize js -->
	<script type="text/javascript" src="{% static 'idea/edit_page/resize.js' %}"></script>

	<!-- Delete confirm js -->
	<script type="text/javascript" src="{% static 'idea/edit_page/delete_confirm.js' %}"></script>

	<div class="wrapper">
		<!-- Show error -->
		{% if error %}
			<div class="flex-wrapper alert-wrapper">
				<div class="alert alert-danger" role="alert">
			  		{{ error }}
				</div>
			</div>
		{% endif %}
		
		<form method="post">
	    	{% csrf_token %}
	    	<table>
	    		<tr id="append-origin1">
	    			<td id="idea-content">
						<p>{{ form.name }}</p>
						<p>{{ form.short_description }}</p>
						<p>{{ form.full_description }}</p>
					</td>
					<td id="idea-setting">
						<h1><b>Settings</b></h1>
						<br>
						<table class="tags">
							<tr id="append-origin2">
								<td class="select-tags">
									<!-- Tags -->
									<h5><b>{{ form.tags.label }}({{ tags.count }}):</b></h5>
									<p>{{ form.tags_remain }}</p>
								</td>
								<td id="exsisting-tag">
									<h5><b>Exsisting Tags({{ idea.tags.count }}):</b></h5>
									{{ form.tags }}
								</td>
							</tr>
							<tr id="append-target2"></tr>
							<tr class="publish-stats" id="append-origin3">
								<td>
									<!-- Publish stats -->
									<h5><b>{{ form.publish_stats.label }}:</b></h5>
									<p>{{ form.publish_stats }}</p>
								</td>
								<td id="delete-button">
									<!-- Delete button -->
									<h5><b>Delete Idea:</b></h5>
									<p id="hidden" style="display:none;">{{ form.delete }}</p>
									<button class="btn btn-warning" id="confirm-button" onclick="click_confirm('hidden','confirm-button'); return false;">Reveal</button>
								</td>
							</tr>
							<tr id="append-target3"></tr>
							<tr>
								<td class="save-changes">
									<h5><b>Save Changes:</b></h5>
									<button class="btn btn-purple-outline btn-bold" type="submit">Save</button>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr id="append-target1">
				</tr>
			</table>
			<div class="idea-image">
				<h1><b>Images</b></h1>
				<br>
				<div class="horizontal-overflow-wrapper">
					<div class="horizontal-container">
						<!-- Header image -->
						<div class="file-wrapper">
							<button class="btn file-button" data-toggle="popover" data-trigger="hover" 
							title="Header image" data-content="Click to change" onclick="window.location.href='{% if idea.header_img %} {% url 'userupload_file_page' pk=idea.header_img.pk referred_obj_name='Idea' referred_obj_pk=idea.pk referred_obj_field='header_img' %} {% else %} {% url 'userupload_file_page' pk=None referred_obj_name='Idea' referred_obj_pk=idea.pk referred_obj_field='header_img' %} {% endif %}'; return false;">
								{% if idea.header_img.file %}
									<img class="header-img" src="{{ idea.header_img.file.url }}">
								{% else %}
									<table class="no-content-text header-img">
									    <tr>
									    	<td class="align-middle">
												<h1><span>No Header Image</span></h1>
											</td>
										</tr>
									</table>
								{% endif %}
							</button>
						</div>
						<!-- Body images -->
						{% for image in idea.body_img.all %}
							<div class="file-wrapper">
								<button class="btn file-button" data-toggle="popover" data-trigger="hover" 
							title="Body image" data-content="Click to change" onclick="window.location.href='{% url 'userupload_file_page' pk=image.pk referred_obj_name='Idea' referred_obj_pk=idea.pk referred_obj_field='body_img' %}'; return false;"><img src="{{ image.file.url }}"></button>
							</div>
						{% endfor %}
						<!-- Add body image -->
						<div class="file-wrapper">
								<button class="btn file-button file-button-add" data-toggle="popover" data-trigger="hover" 
							title="Body image" data-content="Click to add" onclick="window.location.href='{% url 'userupload_file_page' pk=None referred_obj_name='Idea' referred_obj_pk=idea.pk referred_obj_field='body_img' %}'; return false;">+</button>
						</div>
						<!-- Show tooltip after hover -->
						<script type="text/javascript">
							if (!window.mobileAndTabletCheck()) {
								$('.file-button').popover({
									trigger: 'hover'
								})
							}
						</script>
					</div>
				</div>
			</div>
		</form>

		<!-- Timestamp -->
		<div class="timestamp">
			<p>Created at <span class="time">{{ idea.timestamp }}</span></p>
			<p>Last Edited <span class="time">{{ idea.last_edit }}</span></p>
		</div>
	</div>
{% endblock %}