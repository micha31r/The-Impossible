{% extends 'base.html' %}
{% load static %}
{% load tags %}

{% block title %}
	<title>Explore - The Impossible</title>
{% endblock %}

{% block custom_nav_link %}
	<li class="nav-item">
		<button class="dropdown-item hide-svg custom" onclick="window.location.href='{% url 'idea_create_view' %}'"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-square"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg><span>Add Idea</span></button>
	</li>
{% endblock %}

{% block content %}

	<!-- Show join newsletter if not registered -->
	{% if not user.is_authenticated %}
		{% include 'newsletter/join.html' %}
	{% endif %}

	<div class="wrapper">
		<!-- Main css -->
		<link rel="stylesheet" type="text/css" href="{% static 'idea/explore_page/main.css' %}">
		
		<!-- Masonry container resize function -->
		<script type="text/javascript" src="{% static 'idea/explore_page/resize.js' %}"></script>

		<!-- Explore -->
		<div class="explore-header">
			<h2>Weekly Ideas</h2>

			<!-- Display time period -->
			<h5>{{ from_date }} <i>to</i> {{ to_date }}</h5>

			<!-- Change Week -->
			{% if previous_week_num %}
				<button class="btn btn-week" onclick="window.location.href='{% url 'idea_explore_page' week_num=previous_week_num page_num=1 %}'"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFF" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg></button>
			{% endif %}
			{% if next_week_num >= 0 %}
				<button class="btn btn-week" onclick="window.location.href='{% url 'idea_explore_page' week_num=next_week_num page_num=1 %}'"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFF" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></button>
			{% endif %}
		</div>

		<script type="text/javascript" src="{% static 'idea/show_button.js' %}"></script>
		<!-- Display Ideas -->
		<!-- https://tobiasahlin.com/blog/masonry-with-css/ -->
		<div class="flex-container">
			{% for idea in ideas %}
				<div class="flex-wrapper">
					<div class="card" id="card-{{ idea.pk }}">

						<!-- Header image -->
						{% if idea.header_img.file %}
							<div class="card-img-wrapper">
								<img src="{{ idea.header_img.file.url }}" alt="{{ idea.header_img.description }}">
							</div>

							<!-- Circle like button -->
							{% include 'idea/card_like.html' %}
						{% endif %}

						<div class="card-body">
							<!-- Show like button here if there is no header image -->
							{% if idea.header_img.file == None %}
								<!-- Like button and view count -->
								{% include 'idea/like.html' %}
							{% endif %}	

							<!-- Title -->
							<h5 class="card-title"><a href="{% url 'idea_detail_page' pk=idea.pk %}">{{ idea.name }}</a></h5>

							<!-- Short description -->
							<h6 class="card-subtitle mb-2 text-muted">{{ idea.short_description|truncatechars:50 }}</h6>

							<!-- Content -->
							<p class="card-text">{{ idea.full_description|truncatechars:100 }}</p>

							<!-- Author -->
							<p class="author">By {{ idea.author }}</p>

							<!-- Views -->
							<p class="views">Views {{ idea.viewed_user.count|ntt }}</p>
						</div>
					</div>
				</div>
			{% endfor %}
			<span class="flex-wrapper break"></span>
			<span class="flex-wrapper break"></span>
			<span class="flex-wrapper break"></span>
			<span class="flex-wrapper break"></span>
			<span class="flex-wrapper break"></span>
			<!-- Show message is no post -->
			{% if ideas|length == 0 %}
				<table class="no-content-text">
				    <tr>
				    	<td class="align-middle">
							<h1><span>No</span>thing t<span>o</span> sh<span>o</span>w</h1>
							<a href="{% url 'idea_create_view' %}">Click to add ur idea</a>
						</td>
					</tr>
				</table>
			{% endif %}
		</div>

		<!-- Page selector -->
		<div class="page-link-wrapper">
			<!-- Previous page link -->
			<a {% if page_num|add:'-1' > 0 %} href="{% url 'idea_explore_page' week_num=week_num page_num=page_num|add:'-1' %}" {% endif %} class="{% if page_num|add:'-1' > 0 %} change-page {% else %} change-page-unavailable {% endif %}">
				<svg class="left-arrow" width="27" height="41" viewBox="0 0 27 41" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path fill-rule="evenodd" clip-rule="evenodd" d="M26 5.99999L5.99999 26L0.34314 20.3431L20.3431 0.34314L26 5.99999Z"/>
				<path fill-rule="evenodd" clip-rule="evenodd" d="M21 41L0.999991 21L6.65685 15.3431L26.6568 35.3431L21 41Z"/>
				</svg>
			</a>

			<!-- Link omission (...) -->
			{% if page_num|add:'-3' > 0 %}
				<p class="word-omission">..</p>
			{% endif %}

			<!-- All page links -->
			{% for i in max_page|times %}
				<!-- Only show a maximum of 5 page links -->
				{% if i|add:1 < page_num|add:3 and i|add:1 > page_num|add:'-3' %}
					<a class="{% if i|add:1 == page_num %} current-page-link {% else %} page-link {% endif %}" href="{% url 'idea_explore_page' week_num=week_num page_num=i|add:1 %}"><b>{{ i|add:1 }}</b></a>
				{% endif %}
			{% endfor %}

			<!-- Link omission (...) -->
			{% if page_num|add:3 < max_page|add:1 %}
				<p class="word-omission">..</p>
			{% endif %}

			<!-- Next page link -->
			<a {% if page_num|add:1 <= max_page %} href="{% url 'idea_explore_page' week_num=week_num page_num=page_num|add:1 %}" {% endif %} class="{% if page_num|add:1 <= max_page %} change-page {% else %} change-page-unavailable {% endif %}">
				<svg class="right-arrow" width="27" height="41" viewBox="0 0 27 41" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path fill-rule="evenodd" clip-rule="evenodd" d="M1.00001 5.99999L21 26L26.6569 20.3431L6.65686 0.34314L1.00001 5.99999Z"/>
				<path fill-rule="evenodd" clip-rule="evenodd" d="M6.00001 41L26 21L20.3432 15.3431L0.343155 35.3431L6.00001 41Z"/>
				</svg>
			</a>
		</div>
	</div>
	<hr class="section-seperator">

	<!-- Announcement -->
	<!-- Stuff here -->
	<hr class="section-seperator">

	<!-- Discover -->
	<div class="wrapper discover-wrapper">
		<div class="discover-header">
			<h1>Discover</h1>
		</div>
		<br>
		<div class="horizontal-overflow-wrapper">
			<div class="horizontal-container">
				{% for idea in random_ideas %}
					<div class="discover-card">

						<a href="{% url 'idea_detail_page' pk=idea.pk %}"><img class="header-img" src="{{ idea.header_img.file.url }}" alt="{{ idea.header_img.description }}"></a>

						<!-- Title -->
						<h5 class="card-title"><a href="{% url 'idea_detail_page' pk=idea.pk %}">{{ idea.name }}</a></h5>

						<!-- Short description -->
						<h6 class="card-subtitle mb-2 text-muted">{{ idea.short_description|truncatechars:50 }}</h6>

						<!-- Content -->
						<p class="card-text">{{ idea.full_description|truncatechars:80 }}</p>

						<!-- Author -->
						<p class="author">By {{ idea.author }}</p>
					</div>
				{% endfor %}
			</div>
		</div>
	</div>
{% endblock %}